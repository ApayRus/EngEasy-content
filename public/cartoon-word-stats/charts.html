<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–ª–æ–≤</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 1600px;
			margin: 0 auto;
			background: white;
			border-radius: 20px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			padding: 40px;
		}

		h1 {
			color: #667eea;
			margin-bottom: 10px;
			font-size: 2.5em;
		}

		.controls {
			margin: 30px 0;
			display: flex;
			gap: 15px;
			flex-wrap: wrap;
			align-items: center;
		}

		.btn-group {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
		}

		.nav-section {
			margin: 20px 0;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 15px;
		}

		.btn {
			padding: 12px 25px;
			border: none;
			border-radius: 8px;
			font-size: 1em;
			cursor: pointer;
			background: #f0f0f0;
			transition: all 0.3s;
			font-weight: 600;
		}

		.btn:hover {
			background: #e0e0e0;
			transform: translateY(-2px);
		}

		.btn.active {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.nav-controls {
			display: flex;
			gap: 10px;
			align-items: center;
		}

		.nav-btn {
			padding: 10px 20px;
			background: #667eea;
			color: white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-size: 1.2em;
			font-weight: bold;
			transition: all 0.3s;
		}

		.nav-btn:hover:not(:disabled) {
			background: #5568d3;
			transform: scale(1.05);
		}

		.nav-btn:disabled {
			background: #ccc;
			cursor: not-allowed;
		}

		.position-indicator {
			padding: 10px 20px;
			background: #f8f9fa;
			border-radius: 8px;
			font-weight: 600;
			color: #333;
		}

		.chart-wrapper {
			position: relative;
			background: #f8f9fa;
			border-radius: 12px;
			padding: 20px;
			margin: 20px 0;
		}

		.chart-container {
			position: relative;
			height: 700px;
			width: 100%;
		}

		.word-details {
			display: none;
			background: #ffffff;
			padding: 30px;
			border-radius: 12px;
			margin: 30px 0;
			border: 3px solid #667eea;
			animation: slideIn 0.3s ease;
		}

		@keyframes slideIn {
			from {
				opacity: 0;
				transform: translateY(-10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.word-details.active {
			display: block;
		}

		.word-details h2 {
			color: #667eea;
			margin-bottom: 20px;
			font-size: 2.5em;
		}

		.stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 20px;
			margin: 25px 0;
		}

		.stat-card {
			text-align: center;
			padding: 25px;
			background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
			border-radius: 12px;
			border: 2px solid #667eea30;
		}

		.stat-value {
			font-size: 2.5em;
			font-weight: bold;
			color: #667eea;
		}

		.stat-label {
			color: #666;
			margin-top: 5px;
			font-weight: 600;
		}

		.detail-section {
			margin: 30px 0;
		}

		.detail-section h3 {
			color: #333;
			margin-bottom: 15px;
			font-size: 1.5em;
		}

		.forms-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
			gap: 15px;
			margin-top: 15px;
		}

		.form-card {
			background: #f8f9fa;
			padding: 18px;
			border-radius: 10px;
			border-left: 5px solid #667eea;
			transition: all 0.3s;
		}

		.form-card:hover {
			transform: translateX(5px);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
		}

		.form-word {
			font-weight: 700;
			font-size: 1.3em;
			color: #333;
			margin-bottom: 8px;
		}

		.form-count {
			color: #888;
			font-size: 1em;
			margin-bottom: 8px;
		}

		.form-expansion {
			color: white;
			background: #667eea;
			padding: 8px 12px;
			border-radius: 6px;
			font-size: 0.9em;
			margin-top: 10px;
			display: inline-block;
		}

		.close-btn {
			float: right;
			background: #ff6b6b;
			color: white;
			border: none;
			padding: 12px 24px;
			border-radius: 8px;
			cursor: pointer;
			font-size: 1em;
			font-weight: 600;
			transition: all 0.3s;
		}

		.close-btn:hover {
			background: #ff5252;
			transform: scale(1.05);
		}

		.search-box {
			flex: 1;
			min-width: 300px;
		}

		.search-box input {
			width: 100%;
			padding: 12px 20px;
			border: 2px solid #e0e0e0;
			border-radius: 8px;
			font-size: 1em;
			transition: border-color 0.3s;
		}

		.search-box input:focus {
			outline: none;
			border-color: #667eea;
		}

		.info-text {
			color: #666;
			font-size: 0.95em;
			margin: 10px 0;
		}

		/* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
		@media (max-width: 768px) {
			body {
				padding: 5px;
			}

			.container {
				padding: 10px 5px;
				border-radius: 10px;
			}

			h1 {
				font-size: 1.8em;
			}

	.subtitle-text {
		font-size: 0.75em !important;
		margin-bottom: 15px !important;
	}

	.arrows-hint {
		display: none;
	}

	.controls {
				flex-direction: column;
				align-items: stretch;
			}

			.btn-group {
				width: 100%;
				justify-content: center;
			}

			.btn {
				flex: 1;
				padding: 10px 15px;
				font-size: 0.9em;
			}

			.btn-100 {
				display: none;
			}

			.search-box {
				width: 100%;
			}

			.chart-container {
				height: 500px;
				margin: 0;
				padding: 0;
			}

			.chart-wrapper {
				margin: 0;
				padding: 0;
			}

			.nav-section {
				flex-wrap: wrap;
				gap: 10px;
			}

			.nav-btn {
				flex: 1;
				min-width: 100px;
				padding: 12px 15px;
				font-size: 1em;
			}

			.position-indicator {
				width: 100%;
				text-align: center;
				order: -1;
			}

			.forms-grid {
				grid-template-columns: 1fr;
			}

			.word-details {
				padding: 20px;
			}

			.word-details h2 {
				font-size: 1.8em;
			}

			.stat-value {
				font-size: 2em;
			}
		}

		@media (max-width: 480px) {
			.chart-container {
				height: 400px;
			}

			h1 {
				font-size: 1.5em;
			}

			.btn {
				font-size: 0.85em;
				padding: 8px 12px;
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–ª–æ–≤</h1>
		<p class="subtitle-text" style="color: #666; margin-bottom: 20px;">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏<span class="arrows-hint"> ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏
			–¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</span></p>

		<div class="controls">
			<div class="btn-group">
				<button class="btn" onclick="setWordsPerPage(20)">20 —Å–ª–æ–≤</button>
				<button class="btn active" onclick="setWordsPerPage(50)">50 —Å–ª–æ–≤</button>
				<button class="btn btn-100" onclick="setWordsPerPage(100)">100 —Å–ª–æ–≤</button>
			</div>

			<div class="search-box">
				<input type="text" id="searchWord" placeholder="üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞...">
			</div>
		</div>

		<p class="info-text" id="chartInfo">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>

		<div class="chart-wrapper">
			<div class="chart-container">
				<canvas id="wordChart"></canvas>
			</div>
		</div>

		<div class="nav-section">
			<button class="nav-btn" id="prevBtn" onclick="previousPage()">‚óÑ –ù–∞–∑–∞–¥</button>
			<span class="position-indicator" id="positionInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
			<button class="nav-btn" id="nextBtn" onclick="nextPage()">–í–ø–µ—Ä—ë–¥ ‚ñ∫</button>
		</div>

		<div class="word-details" id="wordDetails">
			<button class="close-btn" onclick="closeDetails()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
			<div id="detailsContent"></div>
		</div>
	</div>

	<script>
		let wordsData = {};
		let loadedChunks = new Set();
		let indexData = null;
		let chart = null;
		let currentPage = 0;
		let wordsPerPage = 50;
		let isSearchMode = false;

		// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
		const isMobile = window.innerWidth <= 768;

		// –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—å—à–µ —Å–ª–æ–≤
		if (isMobile) {
			wordsPerPage = 20;
		}

		// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–¥–µ–∫—Å
		fetch('/cartoon-word-stats/chunks/index.json')
			.then(response => response.json())
			.then(index => {
				indexData = index;

				// –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
				if (isMobile) {
					document.querySelectorAll('.btn-group .btn').forEach(btn => {
						btn.classList.remove('active');
						if (btn.textContent.includes('20')) {
							btn.classList.add('active');
						}
					});
				}

				// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π —á–∞–Ω–∫
				loadChunksForPage(0);
			});

		async function setWordsPerPage(count) {
			wordsPerPage = count;
			currentPage = 0;
			await loadChunksForPage(0);

			// –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
			document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
			event.target.classList.add('active');
		}

		async function previousPage() {
			if (currentPage > 0) {
				currentPage--;
				await loadChunksForPage(currentPage);
			}
		}

		async function nextPage() {
			const maxPage = Math.ceil(indexData.totalWords / wordsPerPage) - 1;
			if (currentPage < maxPage) {
				currentPage++;
				await loadChunksForPage(currentPage);
			}
		}

		async function loadChunksForPage(page) {
			const startIdx = page * wordsPerPage;
			const endIdx = startIdx + wordsPerPage;

			// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ —á–∞–Ω–∫–∏ –Ω—É–∂–Ω—ã
			const startChunk = Math.floor(startIdx / 100);
			const endChunk = Math.floor(endIdx / 100);

			// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —á–∞–Ω–∫–∏
			const loadPromises = [];
			for (let chunkNum = startChunk; chunkNum <= endChunk; chunkNum++) {
				if (!loadedChunks.has(chunkNum) && chunkNum < indexData.chunksCount) {
					loadPromises.push(loadChunk(chunkNum));
				}
			}

			if (loadPromises.length > 0) {
				await Promise.all(loadPromises);
			}

			renderChart();
		}

		async function loadChunk(chunkNum) {
			try {
				const response = await fetch(`/cartoon-word-stats/chunks/chunk-${chunkNum}.json`);
				const chunkData = await response.json();

				// –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–∞–Ω–∫–∞ –≤ –æ–±—â–∏–π –æ–±—ä–µ–∫—Ç
				Object.assign(wordsData, chunkData);
				loadedChunks.add(chunkNum);

				console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω —á–∞–Ω–∫ ${chunkNum}`);
			} catch (error) {
				console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞–Ω–∫–∞ ${chunkNum}:`, error);
			}
		}

		function renderChart() {
			if (isSearchMode) return;

			const startIdx = currentPage * wordsPerPage;
			const endIdx = startIdx + wordsPerPage;

			// –ü–æ–ª—É—á–∞–µ–º —Å–ª–æ–≤–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
			const pageWords = indexData.words.slice(startIdx, endIdx);

			// –°–æ–∑–¥–∞–µ–º entries –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
			const entries = pageWords
				.map(word => [word, wordsData[word]])
				.filter(([word, data]) => data); // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

			updateChart(entries);
			updateNavigation();
		}

		function updateChart(entries) {
			const labels = entries.map(([word]) => word);
			const values = entries.map(([, data]) => data.total);

			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ü–≤–µ—Ç–æ–≤ –æ—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ –∫ —Å–∏–Ω–µ–º—É
			const colors = entries.map((_, i) => {
				const ratio = i / entries.length;
				const hue = 250 - (ratio * 30); // –û—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ (280) –∫ —Å–∏–Ω–µ–º—É (250)
				const lightness = 55 + (ratio * 10); // –ù–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏
				return `hsla(${hue}, 70%, ${lightness}%, 0.85)`;
			});

			const ctx = document.getElementById('wordChart').getContext('2d');

			if (chart) {
				chart.destroy();
			}

			chart = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [{
						label: '–ß–∞—Å—Ç–æ—Ç–∞',
						data: values,
						backgroundColor: colors,
						borderColor: colors.map(c => c.replace('0.85', '1')),
						borderWidth: 2,
						borderRadius: 6,
						hoverBackgroundColor: colors.map(c => c.replace('0.85', '0.95')),
						barPercentage: 0.95,
						categoryPercentage: 1.0
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					onClick: (event, elements) => {
						if (elements.length > 0) {
							const index = elements[0].index;
							const word = labels[index];
							showWordDetails(word);
						}
					},
					plugins: {
						legend: {
							display: false
						},
						tooltip: {
							backgroundColor: 'rgba(0, 0, 0, 0.8)',
							padding: 15,
							titleFont: {
								size: 16,
								weight: 'bold'
							},
							bodyFont: {
								size: 14
							},
							callbacks: {
								title: function (context) {
									return context[0].label;
								},
								label: function (context) {
									const word = context.label;
									const data = wordsData[word];
									const formsCount = Object.keys(data.forms).length;
									const forms = Object.keys(data.forms).slice(0, 3).join(', ');
									return [
										`–í—Å–µ–≥–æ: ${context.parsed.y.toLocaleString()}`,
										formsCount > 1 ? `–§–æ—Ä–º: ${formsCount} (${forms}...)` : '',
										'',
										'üñ±Ô∏è –ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π'
									].filter(Boolean);
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							title: {
								display: !isMobile,
								text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π',
								font: {
									size: 16,
									weight: 'bold'
								},
								color: '#333'
							},
							ticks: {
								font: {
									size: 12
								},
								callback: function (value) {
									// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞: 2500 -> 2.5k, 1000 -> 1k
									if (value >= 1000) {
										return (value / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
									}
									return value;
								}
							},
							grid: {
								color: 'rgba(0, 0, 0, 0.05)'
							}
						},
						x: {
							title: {
								display: !isMobile,
								text: '–°–ª–æ–≤–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)',
								font: {
									size: 14,
									weight: 'bold'
								},
								color: '#333'
							},
							ticks: {
								font: {
									size: (() => {
										// –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤
										if (wordsPerPage === 20) {
											return isMobile ? 11 : 14;
										} else if (wordsPerPage === 50) {
											return isMobile ? 8 : 10;
										} else {
											return isMobile ? 7 : 8;
										}
									})(),
									weight: '500'
								},
								color: '#333',
								maxRotation: 90,
								minRotation: 90,
								autoSkip: false,
								maxTicksLimit: isMobile ? wordsPerPage : undefined
							},
							grid: {
								display: false
							}
						}
					},
					animation: {
						duration: 750,
						easing: 'easeInOutQuart'
					}
				}
			});
		}

		function updateNavigation() {
			const totalWords = indexData.totalWords;
			const maxPage = Math.ceil(totalWords / wordsPerPage) - 1;
			const startIdx = currentPage * wordsPerPage + 1;
			const endIdx = Math.min((currentPage + 1) * wordsPerPage, totalWords);

			document.getElementById('prevBtn').disabled = currentPage === 0;
			document.getElementById('nextBtn').disabled = currentPage >= maxPage;
			document.getElementById('positionInfo').textContent =
				`${startIdx}-${endIdx} –∏–∑ ${totalWords.toLocaleString()}`;

			document.getElementById('chartInfo').textContent =
				`–ü–æ–∫–∞–∑–∞–Ω—ã —Å–ª–æ–≤–∞ —Å ${startIdx} –ø–æ ${endIdx} —Ä–∞–Ω–≥. –í—Å–µ–≥–æ –ª–µ–∫—Å–µ–º: ${totalWords.toLocaleString()}`;
		}

		function showWordDetails(word) {
			const data = wordsData[word];
			if (!data) return;

			const formsCount = Object.keys(data.forms).length;
			const expansions = data.expansions || {};

			// –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–Ω–≥ —Å–ª–æ–≤–∞
			const rank = indexData.words.indexOf(word) + 1;

			let html = `
                <h2>#${rank} ${word}</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">${data.total.toLocaleString()}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formsCount}</div>
                        <div class="stat-label">–†–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Object.keys(expansions).length}</div>
                        <div class="stat-label">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–æ–∫</div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3>–í—Å–µ —Ñ–æ—Ä–º—ã —Å–ª–æ–≤–∞ "${word}":</h3>
                    <div class="forms-grid">
            `;

			// –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–º—ã –ø–æ —á–∞—Å—Ç–æ—Ç–µ
			const sortedForms = Object.entries(data.forms).sort((a, b) => b[1] - a[1]);

			sortedForms.forEach(([form, count]) => {
				const expansion = expansions[form];
				const percentage = ((count / data.total) * 100).toFixed(1);
				html += `
                    <div class="form-card">
                        <div class="form-word">${form}</div>
                        <div class="form-count">üìä ${count.toLocaleString()} (${percentage}%)</div>
                        ${expansion ? `<div class="form-expansion">üí¨ ${expansion}</div>` : ''}
                    </div>
                `;
			});

			html += `
                    </div>
                </div>
            `;

			document.getElementById('detailsContent').innerHTML = html;
			document.getElementById('wordDetails').classList.add('active');
			document.getElementById('wordDetails').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
		}

		function closeDetails() {
			document.getElementById('wordDetails').classList.remove('active');
		}

		// –ü–æ–∏—Å–∫
		let searchTimeout;
		document.getElementById('searchWord').addEventListener('input', (e) => {
			clearTimeout(searchTimeout);
			searchTimeout = setTimeout(async () => {
				const query = e.target.value.toLowerCase().trim();

				if (!query) {
					isSearchMode = false;
					await loadChunksForPage(currentPage);
					return;
				}

				isSearchMode = true;

				// –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª–æ–≤–∞ –ø–æ –ø–æ–∏—Å–∫—É –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ (—Ç–æ–ª—å–∫–æ —Å–ª–æ–≤–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞)
				const matchedWords = indexData.words
					.filter(word => word.toLowerCase().startsWith(query))
					.slice(0, 100); // –ú–∞–∫—Å–∏–º—É–º 100 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

				if (matchedWords.length === 0) return;

				// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω—É–∂–Ω—ã–µ —á–∞–Ω–∫–∏ –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
				const chunksNeeded = new Set();
				matchedWords.forEach(word => {
					const idx = indexData.words.indexOf(word);
					const chunkNum = Math.floor(idx / 100);
					chunksNeeded.add(chunkNum);
				});

				// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —á–∞–Ω–∫–∏
				const loadPromises = [];
				for (const chunkNum of chunksNeeded) {
					if (!loadedChunks.has(chunkNum)) {
						loadPromises.push(loadChunk(chunkNum));
					}
				}

				if (loadPromises.length > 0) {
					await Promise.all(loadPromises);
				}

				// –°–æ–∑–¥–∞–µ–º entries –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
				const filtered = matchedWords
					.map(word => [word, wordsData[word]])
					.filter(([, data]) => data);

				updateChart(filtered);

				document.getElementById('chartInfo').textContent =
					`–ù–∞–π–¥–µ–Ω–æ: ${filtered.length} —Å–ª–æ–≤`;
				document.getElementById('positionInfo').textContent = '–ü–æ–∏—Å–∫';
				document.getElementById('prevBtn').disabled = true;
				document.getElementById('nextBtn').disabled = true;
			}, 300); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
		});

		// –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
		document.addEventListener('keydown', (e) => {
			if (isSearchMode || document.getElementById('searchWord') === document.activeElement) return;

			if (e.key === 'ArrowLeft') {
				previousPage();
			} else if (e.key === 'ArrowRight') {
				nextPage();
			}
		});

		// –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤–∞–π–ø–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
		let touchStartX = 0;
		let touchEndX = 0;

		const chartWrapper = document.querySelector('.chart-wrapper');

		chartWrapper.addEventListener('touchstart', (e) => {
			touchStartX = e.changedTouches[0].screenX;
		});

		chartWrapper.addEventListener('touchend', (e) => {
			touchEndX = e.changedTouches[0].screenX;
			handleSwipe();
		});

		function handleSwipe() {
			const swipeThreshold = 50; // –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–≤–∞–π–ø–∞

			if (touchEndX < touchStartX - swipeThreshold) {
				// –°–≤–∞–π–ø –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
				nextPage();
			}

			if (touchEndX > touchStartX + swipeThreshold) {
				// –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
				previousPage();
			}
		}
	</script>
</body>

</html>